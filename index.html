<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LSU NCAR Ida Project</title>
    <link rel="stylesheet" href="styles/site.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
    <script src="leaflet-side-by-side.js"></script>
    <script src="d3.v7.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="landing" class="textbox-background">
        <img src="images/background-1.jpg" alt="picture of coastal louisiana" />
        <div class="textbox-overlay">
            <h1>Social Responses to Climate Change Attributed Flooding in South Louisiana</h1>
            <p>Kevin Smiley, ... list contributors to study here</p>
            <p>Louisiana State University, NSF NCAR, the Water Institute ...</p>
        </div>
    </div>

    <div id="intro" class="textbox-main">
        <div class="text">
            <h2>What is attribution?</h2>
            <p>When talking about climate, attribution refers to .... [text introduction explaining what attribution is / how it works] Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo ...</p>
            <h2>An example of attribution</h2>
            <img src="images/placeholder-1.png" alt="example graph" />
            <p>In the graphs above, we're looking at [explanation and context as needed]. For example, on the left, the graph expresses that in [scenario 1], we attribute [$ amount or buildings damaged] to storm surge damages ...</p>
        </div>
    </div>


    <div class="textbox-background">
        <img src="images/background-2.jpg" alt="picture of coastal louisiana" />
        <div class="textbox-overlay">
            <h2>Impacts across space</h2>
            <p>One thing we can do in our study is to see how these impacts from climate change can really vary from place to place.</p>
        </div>
    </div>

    <div class="visualization-container">
        <div class="visualization-prompt">
            <h2 class="poppins-light">What might 
    
                <div class="dropdown">
                    <button class="dropdown-button">
                      <span id="map1-environmental-value" class="dropdown-value">storm surge flood damages</span>
                      <span class="arrow"></span>
                    </button>
                    <div id="map1-environmental-dropdown" class="environmental dropdown-content">
                        <span id="map1-wind-damages">wind damages</span>
                        <span class="selected-option" id="map1-storm-surge">storm surge flood damages</span>
                    </div>
                </div>
                
                look like in
            
                <div class="dropdown">
                    <button class="dropdown-button">
                    <span id="map1-left-year-value" class="dropdown-value">1971</span>
                    <span class="arrow"></span>
                    </button>
                    <div id="map1-left-year-dropdown" class="dropdown-content">
                        <span id="map1-left-1971" class="selected-option">1971</span>
                        <span id="map1-left-2021">2021</span>
                        <span id="map1-left-2071">2071</span>
                    </div>
                </div>
                
                compared to in
    
                <div class="dropdown">
                    <button class="dropdown-button">
                    <span id="map1-right-year-value" class="dropdown-value">2021</span>
                    <span class="arrow"></span>
                    </button>
                    <div id="map1-right-year-dropdown" class="dropdown-content">
                        <span id="map1-right-1971">1971</span>
                        <span id="map1-right-2021" class="selected-option">2021</span>
                        <span id="map1-right-2071">2071</span>
                    </div>
                </div>
                ?
            </h2>
        </div>

        <div class="map-container">
            <div id="map1-census-toggle">
                <div class="map1-toggle-option active" id="map1-tract">census tract</div>
                <div class="map1-toggle-option" id="map1-block">census block</div>
            </div>

            <div id="map1" class="map">
            </div>
        </div>
    </div>

    <div class="textbox-background">
        <img src="images/background-3.jpg" alt="picture of coastal louisiana" />
        <div class="textbox-overlay">
            <h2>Impacts across society</h2>
            <p>We can also learn about the social make-up of those affected places.</p>
        </div>
    </div>

    <div class="visualization-container">
        <div class="visualization-prompt">
            <h2 class="poppins-light">What might 
    
                <div class="dropdown">
                    <button class="dropdown-button">
                      <span id="map2-environmental-dropdown-value" class="dropdown-value">storm surge flood damages</span>
                      <span class="arrow"></span>
                    </button>
                    <div id="map2-environmental-dropdown" class="environmental dropdown-content">
                        <span id="map2-wind-damages">wind damages</span>
                        <span class="selected-option" id="map2-storm-surge">storm surge flood damages</span>
                    </div>
                </div>
                
            look like for people of different 
            
                <div class="dropdown">
                    <button class="dropdown-button">
                    <span id="map2-social-dropdown-value" class="dropdown-value">incomes</span>
                    <span class="arrow"></span>
                    </button>
                    <div id="map2-social-dropdown" class="social dropdown-content">
                        <span id="education-levels">education levels</span>
                        <span id="poverty-levels">poverty levels</span>
                        <span class="selected-option" id="incomes">incomes</span>
                    </div>
                </div>
                
                in
    
                <div class="dropdown">
                    <button class="dropdown-button">
                    <span id="map2-years-dropdown-value" class="dropdown-value">2021</span>
                    <span class="arrow"></span>
                    </button>
                    <div id="map2-year-dropdown" class="dropdown-content">
                        <span id="map2-1971">1971</span>
                        <span id="map2-2021" class="selected-option">2021</span>
                        <span id="map2-2071">2071</span>
                    </div>
                </div>
                ?
            </h2>
        </div>
        
        <div class="map-container">
            <div id="map2-census-toggle">
                <div class="map2-toggle-option active" id="map2-tract">census tract</div>
                <div class="map2-toggle-option" id="map2-block">census block</div>
            </div>

            <div id="map2" class="map">
            </div>
        </div>
    </div>

    <div class="textbox-background">
        <img src="images/background-4.jpg" alt="picture of coastal louisiana" />
        <div class="textbox-overlay">
            <h2>Conclusion</h2>
            <p>[conclusion content here] Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim...</p>
        </div>
    </div>
</body>
</html>

<script>
    // ------------ SETUP FOR MAP 1: COMPARING ONE ENVIRONMENTAL VARIABLE BETWEEN YEARS ------------
    // base map
    var map1 = L.map('map1', {
        minZoom: 7,
        maxZoom: 10,
        maxBounds: [
        [26, -100.5],
        [35, -82.5]
        ],
        maxBoundsViscosity: 1,
        bounceAtZoomLimits: false
    }).setView([30, -91.5], 8);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd'
    }).addTo(map1);

    // properly center and expand map tiles on load
    setTimeout(function () {
        map1.invalidateSize();
    }, 100);

    // add comparator
    map1.createPane("left")
    map1.createPane("right")
    map1.createPane("labels")

    // add labels layer on top
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        pane: 'labels'
    }).addTo(map1);

    // ------------ MAP 1: initializing user options ------------
    let map1LeftLayer = null;
    let map1RightLayer = null;

    // referring to the options selected in the first visualization prompt
    const map1EnvironmentalDropdown = document.querySelector('#map1-environmental-dropdown');
    const map1LeftYearDropdown = document.querySelector('#map1-left-year-dropdown');
    const map1RightYearDropdown = document.querySelector('#map1-right-year-dropdown');

    let map1EnvironmentalOptions = {"map1-wind-damages": "wind", 
                                    "map1-storm-surge": "storm"};

    let map1LeftYearOptions = {"map1-left-1971": "1971", 
                               "map1-left-2021": "2021", 
                               "map1-left-2071": "2071"};

    let map1RightYearOptions = {"map1-right-1971": "1971", 
                                "map1-right-2021": "2021", 
                                "map1-right-2071": "2071"};

    let map1UserOptions = {
        map1EnvironmentalValue: map1EnvironmentalOptions[map1EnvironmentalDropdown.querySelector('.selected-option').id],
        map1LeftYearValue: map1LeftYearOptions[map1LeftYearDropdown.querySelector('.selected-option').id],
        map1RightYearValue: map1RightYearOptions[map1RightYearDropdown.querySelector('.selected-option').id]
    };

    var map1ColorScale;
    var map1LeftLegend;
    var map1RightLegend;
    var map1Comparator;

    // ------------ MAP 1: user input event handlers ------------
    const map1Tract = document.getElementById('map1-tract');
    const map1Block = document.getElementById('map1-block');

    function setMap1ActiveCensus(option) {
        if (option === 'map1-tract') {
            map1Tract.classList.add('active');
            map1Block.classList.remove('active');
        } else {
            map1Block.classList.add('active');
            map1Tract.classList.remove('active');
        }
    }

    function getMap1SelectedCensus() {
        const activeElement = document.querySelector('.map1-toggle-option.active');
        return activeElement ? activeElement.id : null;
    }

    map1Tract.addEventListener('click', () => {
        setMap1ActiveCensus('map1-tract');
        loadMap1();
    });

    map1Block.addEventListener('click', () => {
        setMap1ActiveCensus('map1-block');
        loadMap1();
    });

    // ------------ MAP 1: data loading ------------
    async function loadMap1() {
        // fetch data file based on selected census level, then call function to render
        let censusLevel = getMap1SelectedCensus();
        let filePath = censusLevel === 'map1-tract' ? "storm_social_tract_cropped.geojson" : "storm_social_block_cropped.geojson";
        let data = await d3.json(filePath, d3.autoType);
        renderMap1GeoJSON(data);
    }

    function renderMap1GeoJSON(data) {
        // handle calls to styling to render the map
        let leftColumn = map1UserOptions.map1EnvironmentalValue + "_#_" + map1UserOptions.map1LeftYearValue;
        let rightColumn = map1UserOptions.map1EnvironmentalValue + "_#_" + map1UserOptions.map1RightYearValue;

        let allMap1Values = data.features.flatMap(f => [
            Number(f.properties[leftColumn]),
            Number(f.properties[rightColumn])
        ]);


        let map1Extent = d3.extent(allMap1Values);
        
        map1ColorScale = d3.scaleQuantile().domain(map1Extent).range(d3.schemeGnBu[8]);

        if (map1LeftLayer) {
            map1.removeLayer(map1LeftLayer);
        }
        if (map1RightLayer) {
            map1.removeLayer(map1RightLayer);
        }
        if (map1Comparator) {
            map1.removeControl(map1Comparator);
        }
        if (map1LeftLegend) {
            map1.removeControl(map1LeftLegend);
        };
        if (map1RightLegend) {
            map1.removeControl(map1RightLegend);
        };

        map1LeftLayer = L.geoJSON(data, { 
            style: feature => getMap1LeftStyle(feature),
            pane: 'left' 
        }).addTo(this.map1);

        map1RightLayer = L.geoJSON(data, { 
            style: feature => getMap1RightStyle(feature),
            pane: 'right' 
        }).addTo(this.map1);

        map1Comparator = L.control.sideBySide([], []).addTo(this.map1);
        map1Comparator.setLeftLayers(map1LeftLayer);
        map1Comparator.setRightLayers(map1RightLayer);  

        map1LeftLegend = createMap1Legends(map1, 'left');
        map1RightLegend = createMap1Legends(map1, 'right');
    }

    function getMap1LeftStyle(feature) {
        let value = feature.properties[map1UserOptions.map1EnvironmentalValue + "_#_" + map1UserOptions.map1LeftYearValue];
        
        return {
            color: 'white', 
            weight: 1, 
            fillOpacity: 0.98,
            fillColor: map1ColorScale(value)
        }
    }

    function getMap1RightStyle(feature) {
        let value = feature.properties[map1UserOptions.map1EnvironmentalValue + "_#_" + map1UserOptions.map1RightYearValue];
        
        return {
            color: 'white', 
            weight: 1, 
            fillOpacity: 0.98,
            fillColor: map1ColorScale(value)
        }
    }

    function createMap1Legends(map, position) {
        let legendPosition = position === 'left' ? 'bottomleft' : 'bottomright';

        const legend = L.control({ position: legendPosition });

        legend.onAdd = function () {
            const div = L.DomUtil.create('div', `info legend ${position}`);
            div.innerHTML = generateMap1LegendHTML(position);
            return div;
        };

        legend.update = function (position) {
            const div = document.querySelector(`.info.legend.${position}`);

            if (div) {
                div.innerHTML = generateMap1LegendHTML(position);
            }
        };

        legend.addTo(map);
        return legend;
    }

    function generateMap1LegendHTML(position) {
        let classes = map1ColorScale.quantiles(),
        labels = [];

        let innerContent = position === 'left' ? 
            `<p class="legend-title">Estimated # of Affected Structures in ${map1UserOptions.map1LeftYearValue}</p>` : 
            `<p class="legend-title">Estimated # of Affected Structures in ${map1UserOptions.map1RightYearValue}</p>`;
        
        if (classes[0] === undefined) {
            innerContent += `<p>No data available</p>`
        } else {
            for (var i = 0; i < classes.length; i++) {
                var start = classes[i].toFixed(0);
                var end = classes[i + 1] ? classes[i + 1].toFixed(0) : "+";

                innerContent += '<i style="background:' + map1ColorScale(classes[i]) + '"></i> ' +
                    start + (end !== "+" ? '&ndash;' + end : '') + '<br>';
            }
        }
        return innerContent;
    }

    function updateMap1UserOptions(newOptions) {
        map1UserOptions = { ...map1UserOptions, ...newOptions };
        if (map1LeftLayer) {
            map1LeftLayer.setStyle(getMap1LeftStyle);
        };
        if (map1RightLayer) {
            map1RightLayer.setStyle(getMap1RightStyle);
        };

        if (map1LeftLegend) {
            map1LeftLegend.update('left');
        }
        if (map1RightLegend) {
            map1RightLegend.update('right');
        }
    }
    loadMap1();

    // ------------ SETUP FOR MAP 2: COMPARING ONE ENVIRONMENTAL VARIABLE AND ONE SOCIAL VARIABLE IN ONE YEAR ------------
    // base map
    var map2 = L.map('map2', {
        minZoom: 7,
        maxZoom: 10,
        maxBounds: [
        [26, -100.5],
        [35, -82.5]
        ],
        maxBoundsViscosity: 1,
        bounceAtZoomLimits: false
    }).setView([30, -91.5], 8);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd'
    }).addTo(map2);

    // properly center and expand map tiles on load
    setTimeout(function () {
        map2.invalidateSize();
    }, 100);

    // add comparator
    map2.createPane("left")
    map2.createPane("right")
    map2.createPane("labels")

    // add labels layer on top
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        pane: 'labels'
    }).addTo(map2);

    // ------------ MAP 2: initializing user options ------------
    let map2LeftLayer = null;
    let map2RightLayer = null;

    // referring to the options selected in the first visualization prompt
    const map2EnvironmentalDropdown = document.querySelector('#map2-environmental-dropdown');
    const map2SocialDropdown = document.querySelector('#map2-social-dropdown');
    const map2YearDropdown = document.querySelector('#map2-year-dropdown');

    let map2EnvironmentalOptions = {"map2-wind-damages": "wind", 
                                    "map2-storm-surge": "storm"};

    let map2SocialOptions = {"education-levels": "college_de",
                            "poverty-levels": "poverty_tr",
                            "incomes": "median_inc"};

    let map2YearOptions = {"map2-1971": "1971",
                            "map2-2021": "2021",
                            "map2-2071": "2071"};

    let map2UserOptions = {
        map2EnvironmentalValue: map2EnvironmentalOptions[map2EnvironmentalDropdown.querySelector('.selected-option').id],
        map2SocialValue: map2SocialOptions[map2SocialDropdown.querySelector('.selected-option').id],
        map2YearValue: map2YearOptions[map2YearDropdown.querySelector('.selected-option').id]
    };

    var map2EnvironmentalColorScale;
    var map2SocialColorScale;
    var map2LeftLegend;
    var map2RightLegend;
    var map2Comparator;

    // ------------ MAP 2: user input event handlers ------------
    const map2Tract = document.getElementById('map2-tract');
    const map2Block = document.getElementById('map2-block');

    function setMap2ActiveCensus(option) {
        if (option === 'map2-tract') {
            map2Tract.classList.add('active');
            map2Block.classList.remove('active');
        } else {
            map2Block.classList.add('active');
            map2Tract.classList.remove('active');
        }
    }

    function getMap2SelectedCensus() {
        const activeElement = document.querySelector('.map2-toggle-option.active');
        return activeElement ? activeElement.id : null;
    }

    map2Tract.addEventListener('click', () => {
        setMap2ActiveCensus('map2-tract');
        loadMap2();
    });

    map2Block.addEventListener('click', () => {
        setMap2ActiveCensus('map2-block');
        loadMap2();
    });

    // ------------ MAP 2: data loading ------------
    async function loadMap2() {
        // fetch data file based on selected census level, then call function to render
        let censusLevel = getMap2SelectedCensus();
        let filePath = censusLevel === 'map2-tract' ? "storm_social_tract_cropped.geojson" : "storm_social_block_cropped.geojson";
        let data = await d3.json(filePath, d3.autoType);
        renderMap2GeoJSON(data);
    }

    function renderMap2GeoJSON(data) {
        // handle calls to styling to render the map
        let leftColumn = map2UserOptions.map2EnvironmentalValue + "_#_" + map2UserOptions.map2YearValue;
        let rightColumn = map2UserOptions.map2SocialValue;

        let map2EnvironmentalExtent = d3.extent(data.features, d => Number(d.properties[leftColumn]));
        let map2SocialExtent = d3.extent(data.features, d => Number(d.properties[rightColumn]));

        console.log(data.features[0].properties)
        
        map2EnvironmentalColorScale = d3.scaleQuantile().domain(map2EnvironmentalExtent).range(d3.schemeGnBu[8]);
        map2SocialColorScale = d3.scaleQuantile().domain(map2SocialExtent).range(d3.schemeYlOrBr[8]);

        if (map2LeftLayer) {
            map2.removeLayer(map2LeftLayer);
        }
        if (map2RightLayer) {
            map2.removeLayer(map2RightLayer);
        }
        if (map2Comparator) {
            map2.removeControl(map2Comparator);
        }
        if (map2LeftLegend) {
            map2.removeControl(map2LeftLegend);
        };
        if (map2RightLegend) {
            map2.removeControl(map2RightLegend);
        };

        map2LeftLayer = L.geoJSON(data, { 
            style: feature => getMap2LeftStyle(feature),
            pane: 'left' 
        }).addTo(this.map2);

        map2RightLayer = L.geoJSON(data, { 
            style: feature => getMap2RightStyle(feature),
            pane: 'right' 
        }).addTo(this.map2);

        map2Comparator = L.control.sideBySide([], []).addTo(this.map2);
        map2Comparator.setLeftLayers(map2LeftLayer);
        map2Comparator.setRightLayers(map2RightLayer);  

        map2LeftLegend = L.control({position: 'bottomleft'});
        map2RightLegend = L.control({position: 'bottomright'});

        map2LeftLegend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend'),
            classes = map2EnvironmentalColorScale.quantiles(),
            labels = [];
            
            div.innerHTML += `<p class="legend-title">Estimated # of Affected Structures in ${map2UserOptions.map2YearValue}</p>`

            if (classes[0] === undefined) {
                div.innerHTML += `<p>No data available</p>`
            } else {
                for (var i = 0; i < classes.length; i++) {
                    var start = classes[i].toFixed(0);
                    var end = classes[i + 1] ? classes[i + 1].toFixed(0) : "+";

                    div.innerHTML += '<i style="background:' + map2EnvironmentalColorScale(classes[i]) + '"></i> ' +
                        start + (end !== "+" ? '&ndash;' + end : '') + '<br>';
                    }
            }
            
            return div;
        };

        map2RightLegend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend'),
            classes = map2SocialColorScale.quantiles(),
            labels = [];

            console.log(classes)
            
            div.innerHTML += `<p class="legend-title">Legend</p>`

            if (classes[0] === undefined) {
                div.innerHTML += `<p>No data available</p>`
            } else {
                for (var i = 0; i < classes.length; i++) {
                var start = classes[i].toFixed(0);
                var end = classes[i + 1] ? classes[i + 1].toFixed(0) : "+";

                div.innerHTML += '<i style="background:' + map2SocialColorScale(classes[i]) + '"></i> ' +
                    start + (end !== "+" ? '&ndash;' + end : '') + '<br>';
                }
            }
            return div;
        };  
        map2LeftLegend.addTo(map2);
        map2RightLegend.addTo(map2);
    }

    function getMap2LeftStyle(feature) {
        let value = feature.properties[map2UserOptions.map2EnvironmentalValue + "_#_" + map2UserOptions.map2YearValue];

        // if (map2LeftLegend) {
        //     map2.removeControl(map2LeftLegend);
        //     map2LeftLegend.addTo(map2);
        // };
        
        return {
            color: 'white', 
            weight: 1, 
            fillOpacity: 0.98,
            fillColor: map2EnvironmentalColorScale(value)
        }
    }

    function getMap2RightStyle(feature) {
        let value = feature.properties[map2UserOptions.map2SocialValue];
        
        // if (map2RightLegend) {
        //     map2.removeControl(map2RightLegend);
        //     map2RightLegend.addTo(map2);
        // };
        
        return {
            color: 'white', 
            weight: 1, 
            fillOpacity: 0.98,
            fillColor: map2SocialColorScale(value)
        }
    }

    function updateMap2UserOptions(newOptions) {
        map2UserOptions = { ...map2UserOptions, ...newOptions };
        if (map2LeftLayer) {
            map2LeftLayer.setStyle(getMap2LeftStyle);
        };
        if (map2RightLayer) {
            map2RightLayer.setStyle(getMap2RightStyle);
        };
    }
    loadMap2();


    // handling dropdowns
    // ------------ DROPDOWN INTERACTION SETUP ------------
    document.querySelectorAll('.dropdown').forEach(dropdown => {
        const dropdownButton = dropdown.querySelector('.dropdown-button');
        const dropdownContent = dropdown.querySelector('.dropdown-content');
        const dropdownOptions = [...dropdown.querySelectorAll('.dropdown-content span')];
        const dropdownArrow = dropdown.querySelector('.arrow');
        const dropdownValue = dropdown.querySelector('.dropdown-value');

        // Handling when dropdown filter chip is clicked
        dropdownButton.addEventListener('click', (event) => {
            const isVisible = dropdownContent.style.display === 'block';
            dropdownContent.style.display = isVisible ? 'none' : 'block';
            dropdownArrow.classList.toggle("active");
        });

        const setDropdownWidth = () => {
            const buttonWidth = dropdownButton.offsetWidth;
            dropdownContent.style.minWidth = `${buttonWidth}px`;
            dropdownContent.style.width = `${buttonWidth}px`;
        };

        addEventListener("load", function () {
            setDropdownWidth();
        })
       
        // Handling when a dropdown option is selected
        dropdownContent.addEventListener('click', (event) => {
            const target = event.target;
            if (target.tagName.toLowerCase() === 'span') {
                let newValue = target.innerHTML;
                dropdownValue.innerHTML = newValue;
                dropdownOptions.forEach((option) => option.classList.remove("selected-option"));
                target.classList.add("selected-option");
                setDropdownWidth();
               
                updateMap1UserOptions({
                    map1EnvironmentalValue: map1EnvironmentalOptions[map1EnvironmentalDropdown.querySelector('.selected-option').id],
                    map1LeftYearValue: map1LeftYearOptions[map1LeftYearDropdown.querySelector('.selected-option').id],
                    map1RightYearValue: map1RightYearOptions[map1RightYearDropdown.querySelector('.selected-option').id],
                });

                updateMap2UserOptions({
                    map2EnvironmentalValue: map2EnvironmentalOptions[map2EnvironmentalDropdown.querySelector('.selected-option').id],
                    map2SocialValue: map2SocialOptions[map2SocialDropdown.querySelector('.selected-option').id],
                    map2YearValue: map2YearOptions[map2YearDropdown.querySelector('.selected-option').id]
                });
            }
        });

        // close dropdown if clicked outside
        window.addEventListener('click', (event) => {
            if (!dropdown.contains(event.target)) {
                if (dropdownContent.style.display === 'block') {
                    dropdownContent.style.display = 'none';
                    dropdownArrow.classList.remove("active");
                }
            }
        });
    });
</script>